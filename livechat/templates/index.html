<!DOCTYPE html>
<html lang=en>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" contents="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
        <title> {{title}}</title>         
        <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    </head>
    <body>        
        <div class="container" style="padding-top:30vh;">
            <form action="" method="POST">
                <div class="row">
                    <div class="col-sm-8">
                        <div id="nomsg">
                            <h1 style="color: #ccc">No message yet!"</h1>
                            <div class="msg-wrapper"></div>
                        </div>                    
                    </div>
                    <div class="col">
                        <label>User:</label>
                        <input type="text" class="username form-control" placeholder="User name">
                        <br>
                        <h4>Message:</h4>
                        <textarea class="message form-control" placeholder="Message"></textarea>
                        <br>
                        <button type="submit" class="btn btn-success">Send</button>
                    </div>
                </div>
            </form>
        </div>
        <script src="//cdnjs.cloudflare.com/ajax/libs/socket.io/2.2.0/socket.io.js" integrity="sha256-yr4fRk/GU1ehYJPAs8P4JlTgu0Hdsp4ZKrx8bDEDC3I=" crossorigin="anonymous"></script>           
        <script>
        var socket = io();
        //broadcast message
        socket.on( 'connect', function(){
            socket.emit( 'my event', {
                data: 'User Connected'    
            });
        } );
        var form =$( 'form' ).on('submit', function( e ) {
            e.preventDefault()
            var user_name = $( 'input.username' ).val()
            var message = $( 'textarea.message' ).val()
            socket.emit( 'my event', {
                user : user_name,
                msg : message
            } )
        } );
        // Empty the message field
        $( 'input.message' ).val('').focus()
        //capture message
        socket.on( 'my response', function( msg ){
            if( typeof msg.user !== 'undefined') {
                $( 'h1' ).remove()
                $( 'div.msg-wrapper').append( '<div class="msgbubble"><b>'+msg.user+': '+'</b>'+msg.msg+'</div>')                
            }
            console.log( msg );
        })
        </script>
    </body>
</html>