{% extends 'base.html' %}

{% block styles %}
{{ super() }}
<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/socket.io/2.2.0/socket.io.js" integrity="sha256-yr4fRk/GU1ehYJPAs8P4JlTgu0Hdsp4ZKrx8bDEDC3I=" crossorigin="anonymous"></script>
    <script>
        var socket = io();
        game_id = '{{game_id}}'
        user_id = '{{user_id}}'
        can_play = false
        socket.on('connect', function() {
            socket.emit('create game', {game_id: game_id, user_id: user_id});
        });

        socket.on('invite', (data)=>{
            console.log(data)
        })

        socket.on('play', (data)=>{
            console.log(data)
        })

        socket.on('play again', (data)=>{
            console.log(data)
            socket.emit('create game', {game_id: game_id, user_id: user_id});

        })
        socket.on('spot picked', (data)=>{
            
            console.log(data)
            cell = data['spot']
            show = data['show']
            $(`.button${cell}`).html(show)
        })
        socket.on('clear', ()=>{
            for (let i = 1; i <= 9; i++){
                $(`.button${i}`).html('')
            }
        })

        socket.on('start', (data)=>{
            can_play = true
            console.log(data)
            if (data['played']){
                played_value = data['play']
                $(`.button${played_value}`).removeClass('x-class')
            }
            
            $('.button1').click(()=>{
                if(can_play){
                    can_play = false
                    btn_select = document.getElementById('button1')
                    selected = 1
                    socket.emit('played', {
                        play: selected,
                        game: game_id,
                        user: user_id
                    })
                }
            })
            
            $('.button2').click(()=>{
                if (can_play){
                    can_play = false
                    selected = 2
                    socket.emit('played', {
                        play: selected,
                        game: game_id,
                        user: user_id
                    })
                }
                
            })
            $('.button3').click(()=>{
                if(can_play){
                    can_play = false
                    selected = 3
                    socket.emit('played', {
                        play: selected,
                        game: game_id,
                        user: user_id
                    })
                } 
            })
            $('.button4').click(()=>{
                if (can_play){
                    can_play = false
                    selected = 4
                    socket.emit('played', {
                        play: selected,
                        game: game_id,
                        user: user_id
                    })
                }
                
            })
            $('.button5').click(()=>{
                if (can_play){
                    can_play = false
                    selected = 5
                    socket.emit('played', {
                        play: selected,
                        game: game_id,
                        user: user_id
                    })
                }
                
            })
            $('.button6').click(()=>{
                if (can_play){
                    can_play = false
                    selected = 6
                    socket.emit('played', {
                        play: selected,
                        game: game_id,
                        user: user_id
                    })
                }
                
            })
            $('.button7').click(()=>{
                if (can_play){
                    can_play = false
                    selected = 7
                    socket.emit('played', {
                        play: selected,
                        game: game_id,
                        user: user_id
                    })
                }
                
            })
            $('.button8').click(()=>{
                if (can_play){
                    can_play = false
                    selected = 8
                    socket.emit('played', {
                        play: selected,
                        game: game_id,
                        user: user_id
                    })
                }
                
            })
            $('.button9').click(()=>{
                if (can_play){
                    can_play = false
                    selected = 9
                    socket.emit('played', {
                        play: selected,
                        game: game_id,
                        user: user_id
                    })
                }
                
            })
        })
        
        socket.on('won', (winneer)=>{
            can_play = false
            console.log(winneer)
            $('.results').append('Congrats!! You won!')
            $(`.results`).css('color','green')
            $(`.results`).css('font-size',' 24px')
        })
        socket.on('lost', (loser)=>{
            can_play = false
            console.log(loser)
            $('.results').append('Boooo!! YOU LOST')
            $(`.results`).css('color','red')
            $(`.results`).css('font-size',' 24px')
        })

        socket.on('draw', (draw)=>{
            can_play = false
            console.log(draw)
            $('.results').append('NO WINNER!!')
            $(`.results`).css('color','white')
            $(`.results`).css('font-size',' 24px')
            socket.emit('create game', {game_id: game_id, user_id: user_id});
        })

        socket.on('back home', ()=>{
            window.location.href = `/`
        })
        socket.on('error', (data)=>{

            console.log(data)
        })
    </script>
{% endblock %}

{% block content %}

<head>
    <style>
        body {
            overflow: hidden;
        }
    </style>
</head>
<div class="main-game">
    <div class="game">
        <div class="alert alert-danger show-error">
            <p class="show-error-txt"></p>
        </div>
        <div class="results">

        </div>

        <div class="game-area">
            <button class="btn button1 game-btn"></button>
            <button class="btn button2 game-btn"></button>
            <button class="btn button3 game-btn"></button>
            <button class="btn button4 game-btn"></button>
            <button class="btn button5 game-btn"></button>
            <button class="btn button6 game-btn"></button>
            <button class="btn button7 game-btn"></button>
            <button class="btn button8 game-btn"></button>
            <button class="btn button9 game-btn"></button>
        </div>
    </div>
        
    <div class="share-link">
        {{url}}

    </div>
    <div class="spinner-border text-warning loader" role="status">
        <span class="sr-only">Loading...</span>
      </div>
    <div class="player-area">       
        <audio controls></audio>
    </div>
    <div class="footer"></div>
</div>
{% endblock %}